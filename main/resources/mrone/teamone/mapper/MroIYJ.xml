<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="mrone.teamone.mapper.MroIYJ">
    
    <select id="getSupplyList" resultType="mrone.teamone.beans.SupplyInfoBean">
		SELECT SP.SP_CODE ,
       SP.SP_NAME,
       SP.SP_TEL,
       SP.SP_ADDRESS,
       SP.SP_CORPNUM,
       SP.SP_BKIND,
       BKIND.BK_NAME
		FROM SP INNER JOIN BKIND ON SP.SP_BKIND = BKIND.BK_CODE
    </select>
    
    <select id="getClientList" resultType="mrone.teamone.beans.ClientInfoBean">
    	
    	SELECT CL.CL_CODE,
      	 CL.CL_NAME,
      	 CL.CL_ADDRESS,
      	 CL.CL_CORPNUM,
      	 CL.CL_HP,
     	 CL.CL_BTYPE,
      	 CL.CL_BKIND,
     	 BK.BK_NAME
		FROM CL INNER JOIN BK ON CL_BKIND = BK.BK_CODE
    </select>
    
    <select id = "getWaitOrderList" resultType="mrone.teamone.beans.MroOrderBean">   
		SELECT * FROM ORDERSVIEW WHERE OS_STATE='OR'	    
    </select>
    
    <select id="getOrderDetail" parameterType="string" resultType="mrone.teamone.beans.MroOrderDetailBean" >
    	SELECT * FROM ORDERDETAILVIEW WHERE OD_OSCODE= #{osCode}
    </select>
    <!-- Mro 반품리스트 받아오는 쿼리 -->
    <select id="getRefundList" resultType="mrone.teamone.beans.MroOrderBean" >
    	SELECT * FROM ORDERSVIEW WHERE OS_STATE='RR'
    </select>
    
    <!-- Mro 교환리스트 받아오는 쿼리 -->
    <select id="getExchangeList" resultType="mrone.teamone.beans.MroOrderBean" >
    	SELECT * FROM ORDERSVIEW WHERE OS_STATE='ER'
    </select>
    
    <select id="getRefundDetail" parameterType="string" resultType="mrone.teamone.beans.MroOrderDetailBean" >
    	SELECT * FROM ORDERDETAILVIEW WHERE OD_OSCODE= #{osCode}
    </select>
    
    <!-- 공급사가 본인의 회사에 들어온 반품,교환리스트를 받는 쿼리 -->
     <select id="getRefundListSp" parameterType="mrone.teamone.beans.MroOrderDetailBean" resultType="mrone.teamone.beans.MroOrderBean" >		
		    SELECT OSV.OS_CODE,
       		OSV.OS_CLCODE,
      	 	OSV.CL_NAME,
       		OSV.OS_DATE,
       		ODV.OD_STCODE AS OS_STATE
		FROM ORDERDETAILVIEW ODV INNER JOIN ORDERSVIEW OSV ON ODV.OD_OSCODE = OSV.OS_CODE
		WHERE OD_STCODE=#{os_state} AND OD_PRSPCODE=#{od_prspcode}
        GROUP BY OSV.OS_CODE ,OSV.OS_CLCODE, OSV.CL_NAME, OSV.OS_DATE, ODV.OD_STCODE
    </select>
    
    <!-- 상세리스트 -->
    <select id="supplyReceiveAsDetail" parameterType="mrone.teamone.beans.MroOrderBean" resultType="mrone.teamone.beans.MroOrderDetailBean">
    	SELECT * FROM ORDERDETAILVIEW WHERE OD_OSCODE=#{os_code}
    </select>
    
    <!-- 반품요청->반품처리로 (수락 또는 거절) 업데이트 -->
    <update id="supplyResponseRefund" parameterType="mrone.teamone.beans.MroOrderBean">
    	UPDATE OD SET OD_STCODE=#{os_state} WHERE OD_OSCODE=#{os_code} AND OD_STCODE='RR'
    </update>
    
    <!-- 반품 OS테이블 RR인거 업데이트ㅡ -->
    <update id="supplyResponseRefundOS" parameterType="mrone.teamone.beans.MroOrderBean">
 		UPDATE OS SET OS_STATE = #{os_state} WHERE OS_CODE=#{os_code} AND OS_STATE='RR'
    </update>
    
    <select id="supplyOSInfo" parameterType="mrone.teamone.beans.MroOrderBean" resultType="mrone.teamone.beans.MroOrderBean">
    	SELECT * FROM OS WHERE OS_CODE= #{os_code}
    </select>
    
    <!-- 구매확정이 있으면, 그 레코드의 정보들을 가져와라 OD테이블-->
	<select id="supplyOCInfo" parameterType="string" resultType="mrone.teamone.beans.MroOrderDetailBean">
		SELECT * FROM OD WHERE OD_OSCODE= #{osCode} AND OD_STCODE='OC'
	</select>
	
	<!-- 오늘날짜의 마지막 주문코드 -->
	<select id="getCount" resultType="int">
		SELECT
		MAX(TO_NUMBER(SUBSTR(OS_CODE,7,5))) FROM OS WHERE SUBSTR(OS_CODE,1,6) =
		TO_CHAR(SYSDATE,'YYMMDD')
	</select>
	
	<!-- OS에 새로운 주문코드+레코드 추가 -->
	<insert id="insNewOrders" parameterType="mrone.teamone.beans.MroOrderBean">
		INSERT INTO OS VALUES(TO_CHAR(SYSDATE,'YYMMDD')||#{os_code},#{os_clcode},SYSDATE,#{os_state})	
	</insert>
	
	<!-- OD에 새로운 주문코드+레코드 추가 -->
	<insert id="insNewOrderDetail" parameterType="mrone.teamone.beans.MroOrderDetailBean">
		INSERT INTO OD VALUES(#{od_prspcode},TO_CHAR(SYSDATE,'YYMMDD')||#{od_oscode},#{od_stcode},#{od_prcode},#{od_quantity})
	</insert>
	
	<select id="supplySearchAs" parameterType="mrone.teamone.beans.MroOrderBean" resultType="mrone.teamone.beans.MroOrderBean">
		SELECT * FROM ORDERSVIEW WHERE "WORD" LIKE '%'|| #{word} ||'%'
	</select>
	
    </mapper>