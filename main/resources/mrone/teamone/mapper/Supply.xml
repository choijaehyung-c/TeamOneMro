<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="mrone.teamone.mapper.Supply">
 <!-- test -->
  <select id="deliveryTest" parameterType="mrone.teamone.beans.DeliveryBean" resultType="mrone.teamone.beans.DeliveryBean">
         SELECT DL_CODE, DL_OSCODE, DL_LCCODE, DV_NAME, DV_HP, DV_SPCODE, SP_NAME, SP_TEL, SP_ADDRESS, DL_DSCODE, DS_NAME
        FROM DV INNER JOIN DL ON DV.DV_CODE = DL.DL_DVCODE
          INNER JOIN SP ON DV.DV_SPCODE = SP.SP_CODE
          INNER JOIN DS ON DL.DL_DSCODE = DS.DS_CODE 
        WHERE DV_CODE = #{dl_dvcode}
    </select>
  
     <update id="insertsdcode" parameterType="mrone.teamone.beans.DeliveryBean">
        UPDATE DL SET DL_DSCODE = #{dl_dscode} WHERE DL_CODE = #{dl_code}
     </update>
<!-- test -->



	<update id="updRequest" parameterType="mrone.teamone.beans.SupplyResponse">
		UPDATE RE SET RE_STATE = #{after} WHERE RE_CODE = #{re_code} AND RE_STATE = #{before}
	</update>
	
	<update id="updRequestDetail" parameterType="mrone.teamone.beans.SupplyResponse">
		UPDATE RD SET RD_STCODE = #{after} WHERE RD_RECODE = #{re_code} AND RD_STCODE = #{before}
	</update>
	
	<update id="updOrder" parameterType="mrone.teamone.beans.SupplyResponse">
		UPDATE OS SET OS_STATE = #{after} WHERE OS_CODE = #{os_code} AND OS_STATE = #{before}
	</update>
	
	<update id="updOrderDetail" parameterType="mrone.teamone.beans.SupplyResponse">
		UPDATE OD SET OD_STCODE = #{after} WHERE OD_OSCODE = #{os_code} AND OD_STCODE = #{before}
	</update>

	<select id="getInvolvedOscode" parameterType="mrone.teamone.beans.SupplyResponse" resultType="string">
		SELECT RE_OSCODE FROM RE WHERE RE_CODE = #{re_code} AND RE_STATE = #{before}
	</select>
	
	<update id="updReasonRD" parameterType="mrone.teamone.beans.RequestOrderDetailBean">
		UPDATE RD SET RD_NOTE = #{rd_note} WHERE RD_RECODE = #{rd_recode} AND RD_STCODE = #{rd_stcode} AND RD_PRCODE = #{rd_prcode}
	</update>
	
	<update id="updReasonOD" parameterType="mrone.teamone.beans.RequestOrderDetailBean">
		UPDATE OD SET OD_NOTE = #{rd_note} WHERE OD_OSCODE = #{rd_recode} AND OD_STCODE = #{rd_stcode} AND OD_PRCODE = #{rd_prcode}
	</update>
	
	<select id="getOSOriginCode" parameterType="string" resultType="string">
		SELECT OS_ORIGIN FROM OS WHERE OS_CODE = #{os_code}
	</select>
	
	<select id="getREOriginCode" parameterType="string" resultType="string">
		SELECT RE_ORIGIN FROM RE WHERE RE_CODE = #{re_code}
	</select>
	
	<select id="getNewODForRefund" parameterType="string" resultType="mrone.teamone.beans.OrderDetailBean">
		SELECT OD_PRSPCODE,OD_STCODE,OD_PRCODE,OD_QUANTITY FROM OD WHERE OD_OSCODE = #{re_code} AND OD_STCODE = 'OA'
	</select>
	
	<select id="getRegion" parameterType="string" resultType="string">
		SELECT NVL(OS_REGION,'NONE') FROM OS WHERE OS_CODE = #{OS_CODE}
	</select>
	
	<select id="getNewRDForRefund" parameterType="string" resultType="mrone.teamone.beans.RequestOrderDetailBean">
		SELECT RD_PRSPCODE,RD_STCODE,RD_PRCODE,RD_QUANTITY FROM RD WHERE RD_RECODE = #{os_code} AND RD_STCODE = 'OA'
	</select>

	<select id="getCLForRefund" parameterType="string" resultType="string">
		SELECT RE_CLCODE FROM RE WHERE RE_CODE = #{re_code}
	</select>

	<select id="getDriver" resultType="string">
		SELECT DV_CODE FROM (SELECT DV_CODE FROM DV ORDER BY DBMS_RANDOM.VALUE) WHERE ROWNUM = 1
	</select>

	<select id="getRecentlyLC" parameterType="string" resultType="string">
		SELECT LC_CODE FROM (SELECT * FROM LC ORDER BY LC_DATE DESC) WHERE DL_OSCODE = #{os_code} AND ROWNUM = 1
	</select>
	
	<insert id="insertFirstLC" parameterType="string">
		INSERT INTO LC VALUES(TO_CHAR(SYSDATE,'YYMMDD')||SEQ_LOCATION_NUM.NEXTVAL,'0','0',SYSDATE,#{os_code})
	</insert>
	
	<insert id="insertFirstDL" parameterType="mrone.teamone.beans.DeliveryInsert">
		INSERT INTO DL VALUES(TO_CHAR(SYSDATE,'YYMMDD')||SEQ_DELIVERY_NUM.NEXTVAL,#{os_code},'1',#{dv_code},#{lc_code})
	</insert>

	
<!--	
<insert id="insClientOrder" parameterType="mrone.teamone.beans.ClientOrderBean">
		INSERT INTO OS VALUES(TO_CHAR(SYSDATE,'YYMMDD')||SEQ_CLIENT_ORDERNUMBER.NEXTVAL,#{os_clcode},TO_DATE(#{os_date},'YYYYMMDDHH24miss'),#{os_state})
	</insert>
	
	<insert id="insClientOrderDetail" parameterType="mrone.teamone.beans.ClientOrderBean">
		INSERT INTO OD VALUES(#{od_prspcode},#{od_oscode},#{od_stcode},#{od_prcode},#{od_quantity})
	</insert>
	
	<select id="getOrderData" parameterType="mrone.teamone.beans.ClientOrderBean" resultType="string">
		SELECT OS_CODE FROM OS WHERE OS_CLCODE = #{os_clcode} and os_date = TO_DATE(#{os_date},'YYYYMMDDHH24miss')
	</select> -->

<select id="supplyAllProductList" parameterType="string" resultType="mrone.teamone.beans.ProductBean">
      SELECT * FROM PR WHERE PR_SPCODE = #{sp_code} AND PR_STCODE = 'PC'
   </select>

















	<select id="getSupplyDealList" resultType="mrone.teamone.beans.RequestOrderBean" parameterType="string">
		SELECT RE_CODE, RE_CLCODE, RE_DATE, CL_NAME, CL_CODE FROM RE INNER JOIN CL ON RE.RE_CLCODE = CL.CL_CODE WHERE RE_SPCODE = #{spcode} AND RE_STATE = 'OC'
	</select>
	

	<select id="getSupplyDealDetail" resultType="mrone.teamone.beans.RequestOrderDetailBean" parameterType="string">
		SELECT RD_PRSPCODE,RD_RECODE,RD_QUANTITY,PR_CODE,PR_NAME,PR_PRICE,PR_TAX 
		FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD.RD_RECODE = #{re_code} AND RD.RD_STCODE = 'OC'
	</select>
	
	<select id="getSearchSupplyDeal" resultType="mrone.teamone.beans.SupplySearchBean" parameterType="string">
		SELECT CL_CODE AS RE_CLCODE,CL_NAME,CL_ADDRESS,CL_CORPNUM,CL_HP,RE_CODE,RE_DATE FROM RE 
		INNER JOIN "CL" ON RE.RE_CLCODE = "CL".CL_CODE 
		WHERE CL_CODE||CL_NAME||CL_ADDRESS||CL_CORPNUM||CL_HP||RE_CODE||RE_DATE LIKE '%' || #{word} || '%'	
	</select>
	
	<insert id="issueTax" parameterType="mrone.teamone.beans.TaxBean">
    INSERT INTO TB VALUES('TB'||#{tb_spcode}||TO_CHAR(SYSDATE,'YYMMDD')||SEQ_TAXBILL_NUM.NEXTVAL, #{tb_oscode}, #{tb_spcode},#{tb_spname},#{tb_spaddress},#{tb_spbtype}, #{tb_spcorpnum}, #{tb_spbkind}, #{tb_clcode}, #{tb_clcorpnum}, #{tb_clname}, #{tb_claddress}, #{tb_clbtype}, #{tb_clbkind},SYSDATE, #{tb_price}, #{tb_tax}, #{tb_ttprice}, #{tb_spemail}, #{tb_clemail}, 'OC')
    </insert>
    
    <select id="getIssuedTax"  parameterType="string" resultType="mrone.teamone.beans.TaxBean">
	SELECT 
	TB_CODE,
	TB_OSCODE,
	TB_CLCODE,
	TB_CLNAME
	FROM TB
	WHERE TB_SPCODE = #{spcode}
    </select>
    
    <select id="getIssuedTaxDetail"  parameterType="string" resultType="mrone.teamone.beans.TaxBean">
		SELECT 
	TB_CODE,
    TB_OSCODE,
    TB_SPCODE,
    TB_SPNAME,
    TB_SPADDRESS,
    TB_SPBTYPE,
    TB_SPCORPNUM,
    TB_SPBKIND,
    TB_CLCODE,
    TB_CLCORPNUM,
    TB_CLNAME,
    TB_CLADDRESS,
    TB_CLBTYPE,
    TB_CLBKIND,
    TB_DATE,
    TB_PRICE,
    TB_TAX,
    TB_TTPRICE,
    TB_SPEMAIL,
    TB_CLEMAIL,
    TB_STCODE,
    BT_NAME AS SPBTNAME,
    BK_NAME AS SPBKNAME,
    CLBT_NAME AS CLBTNAME,
    CLBK_NAME AS CLBKNAME
	FROM TB INNER JOIN BT ON TB.TB_SPBTYPE = BT.BT_CODE
            INNER JOIN BK ON TB.TB_SPBKIND = BK.BK_CODE
            INNER JOIN CLBTYPE ON TB.TB_CLBTYPE = CLBTYPE.CLBT_CODE
            INNER JOIN CLBKIND ON TB.TB_CLBKIND = CLBKIND.CLBK_CODE
	WHERE  TB_CODE = #{tbcode}
    </select>
    
    <select id="getTaxProduct"  parameterType="string" resultType="mrone.teamone.beans.OrderDetailBean">
   SELECT
   RD_PRSPCODE AS OD_PRSPCODE,
   RD_RECODE AS OD_OSCODE,
   RD_STCODE AS OD_STCODE,
   RD_PRCODE AS OD_PRCODE,
   RD_QUANTITY AS OD_QUANTITY,
   PR_NAME,
   PR_PRICE,
   PR_TAX
   FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE
   WHERE RD_RECODE = #{oscode} AND PR_STCODE ='PC'
    </select>
    
	
	<select id="getSupplyCateProductList" parameterType="mrone.teamone.beans.ProductBean" resultType="mrone.teamone.beans.ProductBean">
		SELECT PR_NAME,PR_CODE,PR_PRICE,PR_STOCK FROM PR WHERE PR_SPCODE = #{pr_spcode} AND CATE = #{cate} AND PR_STCODE = 'PC'
	</select>
	
	<select id="supplyGetProductDetail" resultType="mrone.teamone.beans.ProductBean" parameterType="mrone.teamone.beans.ProductBean">
    	SELECT * FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
    </select>
    
    <update id="supplyModifyStock" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STOCK = #{pr_stock} WHERE PR_CODE = #{pr_code} AND PR_STCODE ='PC'
    </update>
    
    <insert id= "supplyRequestModify" parameterType="mrone.teamone.beans.ProductBean">
    	INSERT INTO PR(PR_SPCODE, PR_CODE, PR_STOCK, PR_NAME, PR_IMAGE, PR_PRICE, PR_TAX, PR_INFO,
    				   PR_ORIGIN, PR_SPBKIND, PR_STCODE, CATE, CATE_NAME)
    	  VALUES (#{pr_spcode}, #{pr_code}, #{pr_stock}, #{pr_name}, #{pr_image}, #{pr_price}, #{pr_tax}, #{pr_info},
    	  		  #{pr_origin}, #{pr_spbkind}, #{pr_stcode}, #{cate}, #{cate_name})
    </insert>
    
    <insert id= "supplyRequestDelete" parameterType="mrone.teamone.beans.ProductBean" >
    	INSERT INTO PR(PR_SPCODE, PR_CODE, PR_STOCK, PR_NAME, PR_IMAGE, PR_PRICE, PR_TAX, PR_INFO, PR_ORIGIN, PR_SPBKIND, PR_STCODE, CATE, CATE_NAME)
    	  VALUES (#{pr_spcode}, #{pr_code}, #{pr_stock}, #{pr_name}, #{pr_image}, #{pr_price}, #{pr_tax}, #{pr_info}, #{pr_origin}, #{pr_spbkind}, #{pr_stcode}, #{cate}, #{cate_name})
    </insert>
    
     <select id="MRCheck" parameterType="mrone.teamone.beans.ProductBean" resultType="int">
    	SELECT COUNT(*) FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
    </select>
    
    <update id="updateSupplyRequestModify" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STOCK = #{pr_stock}, PR_NAME = #{pr_name}, PR_PRICE = #{pr_price}, PR_INFO = #{pr_info}, PR_ORIGIN = #{pr_origin} WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
    </update>
    
    <select id="getCate" resultType="mrone.teamone.beans.CGBean">
    	SELECT * FROM CG
    </select>
    
    <insert id = "supplyRequestNewProduct" parameterType="mrone.teamone.beans.ProductBean">
    	INSERT INTO PR(PR_SPCODE, PR_CODE, PR_STOCK, PR_NAME, PR_IMAGE, PR_PRICE, PR_TAX, PR_INFO, PR_ORIGIN, PR_SPBKIND, PR_STCODE, CATE, CATE_NAME)
    	  VALUES (#{pr_spcode},TO_CHAR(SYSDATE,'YYMMDD')||SEQ_PRCODE.NEXTVAL, #{pr_stock}, #{pr_name}, #{pr_image}, #{pr_price}, #{pr_tax}, #{pr_info}, #{pr_origin}, #{pr_spbkind}, #{pr_stcode}, #{cate}, #{cate_name})
    </insert>
    
    <!-- 수정 -->
    <select id="getSupplyWaitOrderList" parameterType="string" resultType="mrone.teamone.beans.RequestOrderBean">
   SELECT 
   RE_CODE,
   RE_CLCODE,
   RE_SPCODE,
   RE_DATE,
   RE_STATE,
    CL.CL_NAME,
    CL.CL_HP
   FROM RE INNER JOIN CL ON RE_CLCODE=CL.CL_CODE 
    WHERE RE_STATE = 'OR'AND RE_SPCODE = #{spcode}
    </select>
    
    <!-- 수정 -->
    <select id="getSupplyClearOrderList" parameterType="string" resultType="mrone.teamone.beans.RequestOrderBean">
   SELECT 
   RE_CODE,
   RE_CLCODE,
   RE_SPCODE,
   RE_DATE,
   RE_STATE,
    CL.CL_NAME,
    CL.CL_HP
   FROM RE INNER JOIN CL ON RE_CLCODE=CL.CL_CODE 
    WHERE RE_STATE = 'OA'AND RE_SPCODE = #{spcode}
    </select>
    
    <!-- 수정 -->
    <select id="getSupplyWaitOrderListD" parameterType="string" resultType="mrone.teamone.beans.RequestOrderDetailBean">
   SELECT 
   RD_PRSPCODE, 
   RD_RECODE, 
   RD_PRCODE, 
   RD_QUANTITY, 
   RD_STCODE,
    PR_IMAGE,
    PR_PRICE,
    PR_TAX,
    SUM(PR_PRICE+PR_TAX)*RD_QUANTITY AS "PR_TTPRICE",
    PR_NAME
   FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD_RECODE = #{recode}  AND PR_STCODE='PC'
    GROUP BY RD_PRSPCODE, RD_RECODE, RD_PRCODE, RD_QUANTITY, RD_STCODE, PR_TAX, PR_NAME, PR_PRICE, PR_IMAGE
       </select>
    
    <!-- 수정 -->
   <select id="getSupplyClearOrderListD" parameterType="string" resultType="mrone.teamone.beans.RequestOrderDetailBean">
   SELECT 
   RD_PRSPCODE, 
   RD_RECODE, 
   RD_PRCODE, 
   RD_QUANTITY, 
   RD_STCODE,
    PR_IMAGE,
    PR_PRICE,
    PR_TAX,
    SUM(PR_PRICE+PR_TAX)*RD_QUANTITY AS "PR_TTPRICE",
    PR_NAME
   FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD_RECODE = #{recode}  AND PR_STCODE='PC'
    GROUP BY RD_PRSPCODE, RD_RECODE, RD_PRCODE, RD_QUANTITY, RD_STCODE, PR_TAX, PR_NAME, PR_PRICE, PR_IMAGE
    </select>
    
        <select id="getRefuseOrderList" parameterType="string" resultType="mrone.teamone.beans.RequestOrderBean">
    SELECT 
      RE_CODE,
      RE_CLCODE,
      RE_SPCODE,
      RE_DATE,
      RE_STATE,
       CL.CL_NAME,
       CL.CL_HP
      FROM RE INNER JOIN CL ON RE_CLCODE=CL.CL_CODE 
    WHERE RE_STATE = 'OF' AND RE_SPCODE = #{spcode}
    </select>
    
        <!-- 수정 -->
    
    <select id="getSupplyRefuseOrderListD" parameterType="string" resultType="mrone.teamone.beans.RequestOrderDetailBean">
    SELECT 
   RD_PRSPCODE, 
   RD_RECODE, 
   RD_PRCODE, 
   RD_QUANTITY, 
   RD_STCODE,
    PR_IMAGE,
    PR_PRICE,
    PR_TAX,
    SUM(PR_PRICE+PR_TAX)*RD_QUANTITY AS "PR_TTPRICE",
    PR_NAME,
    RD_NOTE
   FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD_RECODE = #{recode}
    GROUP BY RD_PRSPCODE, RD_RECODE, RD_PRCODE, RD_QUANTITY, RD_STCODE, PR_TAX, PR_NAME, PR_PRICE, PR_IMAGE, RD_NOTE
    </select>
    
    <!-- 추가 수정 -->  
    <update id="supplyGoDelivery" parameterType="string">
        UPDATE DL SET DL_DSCODE='2' WHERE DL_OSCODE=#{recode}
    </update>
    
    <!-- 추가 수정  -->
    <select id="getTrackDeliveryList" parameterType="string" resultType="mrone.teamone.beans.DeliveryBean">
           SELECT DL.DL_CODE,
                 DL.DL_OSCODE,
                 DL.DL_DSCODE,
                 DS.DS_NAME,
                 DL.DL_DVCODE,
                 DV.DV_NAME,
                 DV.DV_HP
             FROM DL INNER JOIN DV ON DL.DL_DVCODE = DV.DV_CODE
            INNER JOIN DS ON DL.DL_DSCODE = DS.DS_CODE
          WHERE DV_SPCODE=#{spcode} AND DL_DSCODE >= 2
    </select>
    
    <!-- 추가 수정 -->
    <select id="getTrackDL" parameterType="string" resultType="mrone.teamone.beans.DeliveryBean">
       SELECT * FROM LC WHERE DL_OSCODE=#{recode}
    </select>
    
<!--     <select id="updateRequestOrderState" parameterType="mrone.teamone.beans.RequestOrderDetailBean" resultType="mrone.teamone.beans.RequestOrderBean">
	UPDATE REQUEST SET RE_STATE = 'OA' WHERE RE_CODE = #{rd_recode}
    </select>
    
    <select id="updateRequestOrderState2" parameterType="mrone.teamone.beans.RequestOrderDetailBean" resultType="mrone.teamone.beans.RequestOrderBean">
	UPDATE REQUESTDETAIL SET RD_STCODE = 'OA' WHERE RD_RECODE = #{rd_recode}
    </select> -->
    
<!--     <insert id="insertDL" parameterType="mrone.teamone.beans.RequestOrderDetailBean" >
	INSERT INTO DELIVERY VALUES ('222222222', #{rd_recode}, '1', 'ANY000', '000000000')
    </insert> -->
    
    <select id="getDLlist"  resultType="mrone.teamone.beans.DeliveryBean">
	SELECT 
	DL_CODE, 
	DL_OSCODE, 
	DS_CODE, 
	DS_NAME, 
	DV_CODE, 
	DV_NAME, 
    DL_LCCODE 
	FROM DL INNER JOIN DS ON DL.DL_DSCODE = DS.DS_CODE INNER JOIN "DV" ON DL.DL_DVCODE = DV.DV_CODE
    </select>
    
    <update id="updateDL" parameterType="mrone.teamone.beans.DeliveryBean">
 		UPDATE DL SET DL_DSCODE = '2', DL_DVCODE = #{dl_dvcode} WHERE DL_CODE = #{dl_code}
    </update>
    
    <select id="getTaxCL"  resultType="mrone.teamone.beans.ClientInfoBean">
	SELECT 
	CL_CODE, 
	CL_NAME, 
	CL_ADDRESS, 
	CL_CORPNUM   
	FROM CL
    </select>
    
    <select id="choiceSPInfo"  parameterType="String" resultType="mrone.teamone.beans.SupplyInfoBean">
	SELECT  
	SP.SP_CODE, 
    SP.SP_NAME, 
    SP.SP_TEL, 
    SP.SP_ADDRESS, 
    SP.SP_CORPNUM, 
    SP.SP_BKIND, 
    SP.SP_BTYPE, 
    SD.SD_EMAIL,
    BKIND.BK_NAME, 
    BTYPE.BT_NAME 
	FROM SP INNER JOIN BKIND ON SP.SP_BKIND = BKIND.BK_CODE 
            INNER JOIN BTYPE ON SP.SP_BTYPE = BTYPE.BT_CODE 
            INNER JOIN SD ON SP.SP_CODE = SD.SD_SPCODE 
    WHERE SP_CODE = #{spcode}
    </select>
    
    <select id="choiceCLInfo"  parameterType="String" resultType="mrone.teamone.beans.ClientInfoBean">
	SELECT   
	CL.CL_CODE,  
    CL.CL_NAME,  
  	CL.CL_HP,  
    CL.CL_ADDRESS,  
   	CL.CL_CORPNUM,  
 	CL.CL_BKIND, 
   	CL.CL_BTYPE, 
   	CL.CL_EMAIL, 
    BKIND.BK_NAME,  
    BTYPE.BT_NAME   
	FROM CL INNER JOIN BKIND ON CL.CL_BKIND = BKIND.BK_CODE  
    INNER JOIN BTYPE ON CL.CL_BTYPE = BTYPE.BT_CODE
    WHERE CL_CODE = #{cl_code}   
   	</select>
    
    <select id="getTaxdeal" parameterType ="string"  resultType="mrone.teamone.beans.RequestOrderBean">
	SELECT 
	RE_CODE, 
	RE_CLCODE, 
	CL_NAME,
	RE_DATE   
	FROM RE INNER JOIN CL ON RE.RE_CLCODE = CL.CL_CODE 
            LEFT OUTER JOIN TB ON RE.RE_CODE = TB.TB_OSCODE
    WHERE RE_SPCODE = #{spcode} AND  RE_STATE='OC' AND TB.TB_OSCODE IS NULL
    </select>
    
    <select id="choiceDillInfo"  resultType="mrone.teamone.beans.RequestOrderDetailBean">
	SELECT 
	PR_NAME, 
	RD_QUANTITY, 
	PR_PRICE, 
	PR_TAX 
	FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD_PRSPCODE = 'KR001D'AND RD_RECODE = #{rd_recode}
    </select>
    
       
    <!-- 공급사가 본인의 회사에 들어온 반품,교환리스트를 받는 쿼리 -->
    <select id="getReceiveAsListSp" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.RequestOrderBean" >		
		SELECT RE_CODE,RE_CLCODE,TO_CHAR(RE_DATE,'YYYY-MM-DD') AS RE_DATE,CL_NAME,CL_HP,RE_ORIGIN,RE_STATE FROM RE INNER JOIN "CL" ON RE.RE_CLCODE = CL.CL_CODE 
		WHERE (RE.RE_STATE = ${re_state}) AND RE.RE_SPCODE = #{re_spcode}
    </select>
    
    <!-- 상세리스트 -->
    <select id="supplyReceiveAsDetail" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.RequestOrderDetailBean">
    	SELECT RD_PRCODE,RD_STCODE,PR_NAME,PR_PRICE,PR_TAX,PR_INFO,PR_ORIGIN,CATE_NAME,RD_RECODE,RD_NOTE FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE 
    	WHERE RD.RD_RECODE = #{re_code} AND PR.PR_STCODE ='PC'
    </select>
    
    <select id="getPrnameAndCount" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="string">
    	SELECT PR_NAME FROM RD INNER JOIN PR ON PR.PR_SPCODE = RD.RD_PRSPCODE AND PR.PR_CODE = RD.RD_PRCODE WHERE RD_RECODE = #{re_code}
    </select>
    
    <delete id="deleteMR" parameterType="mrone.teamone.beans.ProductBean">
		DELETE FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'MR'
	</delete>
	
	<delete id="deleteDR" parameterType="mrone.teamone.beans.ProductBean">
		DELETE FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'DR'
	</delete>
	
	<select id="supplyPRAFProductList" parameterType="string" resultType="mrone.teamone.beans.ProductBean">
		SELECT PR_CODE, PR_NAME, CATE_NAME, PR_STCODE, ST_NAME 
     	FROM PR INNER JOIN ST ON PR.PR_STCODE = ST.ST_CODE
     	WHERE  PR_SPCODE = #{sp_code} AND 
     		   (PR_STCODE = 'PR' OR  
			   PR_STCODE = 'AF')
	</select>
	
	<select id="supplyMRDRDAProductList" parameterType="string" resultType="mrone.teamone.beans.ProductBean">
		SELECT PR_CODE, PR_NAME, CATE_NAME, PR_STCODE, ST_NAME 
     	FROM PR INNER JOIN ST ON PR.PR_STCODE = ST.ST_CODE
		WHERE PR_SPCODE = #{sp_code} AND 
			  (PR_STCODE = 'DR' OR  
			  PR_STCODE = 'DF' OR 
			  PR_STCODE = 'DA' OR 
			  PR_STCODE = 'MR' OR 
			  PR_STCODE = 'RF')
	</select>
	
	<delete id="supplyRequestCancel" parameterType="mrone.teamone.beans.ProductBean">
		DELETE FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
	</delete>
    
    <!-- 반품요청->반품처리로 (수락) 업데이트 -->
    <!-- <update id="supplyResponseRefund" parameterType="mrone.teamone.beans.RequestOrderBean">
    	UPDATE OD SET OD_STCODE=#{re_state} WHERE OD_OSCODE=#{re_code} AND OD_STCODE='RR'
    </update> -->
    
    <!-- 반품 OS테이블 RR인거 업데이트ㅡ -->
    <!-- <update id="supplyResponseRefundOS" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE OS SET OS_STATE = #{re_state} WHERE OS_CODE=#{re_code} AND OS_STATE='RR'
    </update> -->
    
    <!-- 반품 RD테이블 RR인거 업데이트ㅡ -->
    <!-- <update id="supplyResponseRefundRD" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE RD SET RD_STCODE = #{re_state} WHERE RD_RECODE=#{re_code} AND RD_STCODE='RR'
    </update> -->
    
    <!-- 반품 RE테이블 RR인거 업데이트ㅡ -->
    <!-- <update id="supplyResponseRefundRE" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE RE SET RE_STATE = #{re_state} WHERE RE_CODE=#{re_code} AND RE_STATE='RR'
    </update> -->
    
    <!-- 쓰는거 -->
   <!--  <select id="selRequest" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.MroOrderDetailBean">
    	select od.od_prspcode,
       od.od_oscode,
       od.od_stcode,
       od.od_prcode,
       od.od_quantity,
       od.od_note,
       os.os_clcode
	from od inner join os on od.od_oscode = os.os_code 
	where OD_OSCODE= #{re_code} AND OD_STCODE=#{re_state}
    </select> -->
    
    <!-- 쓰는거 -->
   <!--  <insert id="insNewOrders" parameterType="mrone.teamone.beans.RequestOrderBean">
    	INSERT INTO OS VALUES(TO_CHAR(SYSDATE,'YYMMDD')||SEQ_CLIENT_ORDERNUMBER.NEXTVAL,#{re_clcode},SYSDATE,#{re_state})
    </insert> -->
    
    <!--  쓰는거-->
   <!--  <insert id="insNewOd" parameterType="mrone.teamone.beans.MroOrderDetailBean">
    	INSERT INTO OD VALUES (#{od_prspcode},TO_CHAR(SYSDATE,'YYMMDD')||#{od_oscode},#{od_stcode},#{od_prcode},#{od_quantity},'')
    </insert> -->
    
    <!-- 쓰는거 -->
    <!-- <insert id= "insNewRequest" parameterType="mrone.teamone.beans.RequestOrderBean">
    	INSERT INTO RE VALUES (TO_CHAR(SYSDATE,'YYMMDD')||#{re_oscode},#{re_clcode},#{re_spcode},TO_CHAR(SYSDATE,'YYMMDD')||#{re_oscode},SYSDATE,#{re_state})
    </insert> -->
    
    <!-- 쓰는거 -->
   <!--  <insert id= "insNewRd" parameterType="mrone.teamone.beans.MroOrderDetailBean">
    	INSERT INTO RD VALUES (#{od_prspcode}, TO_CHAR(SYSDATE,'YYMMDD')||#{od_oscode},#{od_prcode},#{od_quantity},#{od_stcode},'')
    </insert> -->
    
    <!-- 교환 OD 테이블 요청 -> 수락 또는 거절 -->
    <!--   <update id="supplyResponseExchangeOD" parameterType="mrone.teamone.beans.RequestOrderBean">
    	UPDATE OD SET OD_STCODE=#{re_state} WHERE OD_OSCODE=#{re_code} AND OD_STCODE='ER'
    </update> -->
    
    <!-- 교환 OS 테이블 요청 -> ER인거 업데이트 -->
     <!--  <update id="supplyResponseExchangeOS" parameterType="mrone.teamone.beans.RequestOrderBean">
   		 UPDATE OS SET OS_STATE = #{re_state} WHERE OS_CODE=#{re_code} AND OS_STATE='ER'
    </update> -->
    
    <!--  <update id="supplyResponseExchageRD" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE RD SET RD_STCODE = #{re_state} WHERE RD_RECODE=#{re_code} AND RD_STCODE='ER'
    </update> -->
    
    <!-- 
    <update id="supplyResponseExchageRE" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE RE SET RE_STATE = #{re_state} WHERE RE_CODE=#{re_code} AND RE_STATE='ER'
    </update> -->
 	
	<select id="supplySearchAs" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.RequestOrderBean">
		   SELECT * FROM REQUESTVIEW WHERE "WORD" LIKE '%'|| #{word} ||'%' 
	</select>
	
	<!-- <select id="getCount" resultType="int">
		SELECT
		MAX(TO_NUMBER(SUBSTR(OS_CODE,7,5))) FROM OS WHERE SUBSTR(OS_CODE,1,6) =
		TO_CHAR(SYSDATE,'YYMMDD')
	</select> -->
	<!-- 
	<insert id="makeDeliveryLocate">
		INSERT INTO LC VALUES (TO_CHAR(SYSDATE,'YYMMDD')||SEQ_LOCATION_NUM.NEXTVAL,'0','0',SYSDATE)
	</insert>
	 -->
	<!-- <select id="maxLCcode" resultType="string">
		SELECT 
		MAX(TO_NUMBER(SUBSTR(LC_CODE,1,9))) AS lccode FROM LC WHERE SUBSTR(LC_CODE,1,6) =
		TO_CHAR(SYSDATE,'YYMMDD')
	</select> -->
	
	<!-- <insert id="supplyAskDelivery" parameterType="mrone.teamone.beans.DeliveryBean">
		INSERT INTO DL VALUES (TO_CHAR(SYSDATE,'YYMMDD')||SEQ_DELIVERY_NUM.NEXTVAL, #{dl_oscode},#{dl_dscode},#{dl_dvcode},#{dl_lccode})
	</insert> -->
	
	
	<select id="supplyGetCategory" resultType="mrone.teamone.beans.ProductBean">
		SELECT * FROM CG
	</select>
	
	<select id="supplyGetBK" resultType="mrone.teamone.beans.ProductBean">
		SELECT * FROM BKIND
	</select>
	
	<select id="supplyProductList" parameterType="mrone.teamone.beans.ProductBean" resultType="mrone.teamone.beans.ProductBean">
		SELECT * FROM PR WHERE PR_SPCODE=#{pr_spcode} AND CATE=#{cate}
	</select>
	
	<select id="supplySearchProduct" parameterType="mrone.teamone.beans.ProductBean" resultType="mrone.teamone.beans.ProductBean">
		SELECT * FROM PRODUCTVIEW WHERE PR_SPCODE=#{pr_spcode} AND "WORD" LIKE '%'|| #{word}||'%'
	</select>
	
			<!-- 수정2 -->
	<select id="getChart" parameterType="string" resultType="mrone.teamone.beans.RequestOrderDetailBean">
	SELECT SUM(RD_QUANTITY) AS RD_QUANTITY ,RD_PRCODE,PR_NAME
	FROM (SELECT * FROM RD INNER JOIN PR ON RD.RD_PRCODE=PR.PR_CODE ORDER BY RD_QUANTITY DESC)
	WHERE RD_PRSPCODE=#{spcode} AND RD_STCODE='OC'  GROUP BY RD_PRCODE, PR_NAME ORDER BY RD_QUANTITY DESC
	</select>
	
	
	<select id="seleteDL" parameterType="string" resultType="mrone.teamone.beans.DeliveryBean">
		SELECT DL_OSCODE, DL_LCCODE FROM DL WHERE DL_DVCODE = #{dvcode} AND DL_DSCODE='2'
	</select>
	
	<insert id="insertXY" parameterType="mrone.teamone.beans.DeliveryBean">
		INSERT INTO LC(LC_CODE, DL_OSCODE, LC_DATE, LC_X, LC_Y)
		VALUES(#{dl_lccode}, #{dl_oscode}, SYSDATE, #{lc_x}, #{lc_y})
	</insert>
	
	<select id="supplyGetSellProductCate" parameterType="string" resultType="mrone.teamone.beans.CGBean">
		SELECT CATE, CATE_NAME
		FROM PR  
		WHERE PR_SPCODE = #{spcode}
		GROUP BY CATE, CATE_NAME
	</select>
	
</mapper>