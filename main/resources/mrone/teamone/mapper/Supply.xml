<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="mrone.teamone.mapper.Supply">
	<select id="getSupplyDealList" resultType="mrone.teamone.beans.RequestOrderBean" parameterType="string">
		SELECT * FROM RE WHERE RE_SPCODE = #{re_spcode} AND RE_STATE = 'OC'
	</select>
	
	<select id="getSupplyDealDetail" resultType="mrone.teamone.beans.RequestOrderDetailBean" parameterType="string">
		SELECT RD_PRSPCODE,RD_RECODE,RD_QUANTITY,PR_CODE,PR_NAME,PR_PRICE,PR_TAX 
		FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD.RD_RECODE = #{re_code} AND RD.RD_STCODE = 'OC';
	</select>
	
	<select id="getSearchSupplyDeal" resultType="mrone.teamone.beans.SupplySearchBean" parameterType="string">
		SELECT CL_CODE,CL_NAME,CL_ADDRESS,CL_CORPNUM,CL_HP,RE_CODE,RE_DATE FROM RE 
		INNER JOIN "CL" ON RE.RE_CLCODE = "CL".CL_CODE 
		WHERE CL_CODE||CL_NAME||CL_ADDRESS||CL_CORPNUM||CL_HP||RE_CODE||RE_DATE LIKE '%' || #{word} || '%'	
	</select>
	
	<select id="getSupplyCateProductList" parameterType="mrone.teamone.beans.ProductBean" resultType="mrone.teamone.beans.ProductBean">
		SELECT PR_NAME,PR_CODE,PR_PRICE,PR_STOCK FROM PR WHERE PR_SPCODE = #{pr_spcode} AND CATE = #{cate} AND PR_STCODE = 'PC'
	</select>
	
	<select id="supplyGetProductDetail" resultType="mrone.teamone.beans.ProductBean" parameterType="mrone.teamone.beans.ProductBean">
    	SELECT * FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'PC'
    </select>
    
    <update id="supplyModifyStock" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STOCK = #{pr_stock} WHERE PR_CODE = #{pr_code} AND PR_STCODE ='PC'
    </update>
    
    <insert id= "supplyRequestModify" parameterType="mrone.teamone.beans.ProductBean">
    	INSERT INTO PR(PR_SPCODE, PR_CODE, PR_STOCK, PR_NAME, PR_IMAGE, PR_PRICE, PR_TAX, PR_INFO,
    				   PR_ORIGIN, PR_SPBKIND, PR_STCODE, CATE, CATE_NAME)
    	  VALUES (#{pr_spcode}, #{pr_code}, #{pr_stock}, #{pr_name}, #{pr_image}, #{pr_price}, #{pr_tax}, #{pr_info},
    	  		  #{pr_origin}, #{pr_spbkind}, #{pr_stcode}, #{cate}, #{cate_name})
    </insert>
    
    <insert id= "supplyRequestDelete" parameterType="mrone.teamone.beans.ProductBean" >
    	INSERT INTO PR(PR_SPCODE, PR_CODE, PR_STOCK, PR_NAME, PR_IMAGE, PR_PRICE, PR_TAX, PR_INFO, PR_ORIGIN, PR_SPBKIND, PR_STCODE, CATE, CATE_NAME)
    	  VALUES (#{pr_spcode}, #{pr_code}, #{pr_stock}, #{pr_name}, #{pr_image}, #{pr_price}, #{pr_tax}, #{pr_info}, #{pr_origin}, #{pr_spbkind}, #{pr_stcode}, #{cate}, #{cate_name})
    </insert>
    
     <select id="MRCheck" parameterType="mrone.teamone.beans.ProductBean" resultType="int">
    	SELECT COUNT(*) FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
    </select>
    
    <update id="updateSupplyRequestModify" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STOCK = #{pr_stock}, PR_NAME = #{pr_name}, PR_PRICE = #{pr_price}, PR_INFO = #{pr_info}, PR_ORIGIN = #{pr_origin} WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
    </update>
    
    <select id="getCate" resultType="mrone.teamone.beans.CGBean">
    	SELECT * FROM CG
    </select>
    
    <insert id = "supplyRequestNewProduct" parameterType="mrone.teamone.beans.ProductBean">
    	INSERT INTO PR(PR_SPCODE, PR_CODE, PR_STOCK, PR_NAME, PR_IMAGE, PR_PRICE, PR_TAX, PR_INFO, PR_ORIGIN, PR_SPBKIND, PR_STCODE, CATE, CATE_NAME)
    	  VALUES (#{pr_spcode}, #{pr_code}, #{pr_stock}, #{pr_name}, #{pr_image}, #{pr_price}, #{pr_tax}, #{pr_info}, #{pr_origin}, #{pr_spbkind}, #{pr_stcode}, #{cate}, #{cate_name})
    </insert>
    
    <select id="getSupplyWaitOrderList" parameterType="String" resultType="mrone.teamone.beans.RequestOrderBean">
	SELECT 
	RE_CODE,
	RE_CLCODE,
	RE_SPCODE,
	RE_DATE,
	RE_STATE
	FROM RE WHERE RE_STATE = 'OR'AND RE_SPCODE = #{sp}
    </select>
    
    <select id="getSupplyClearOrderList" parameterType="String" resultType="mrone.teamone.beans.RequestOrderBean">
	SELECT 
	RE_CODE,
	RE_CLCODE,
	RE_SPCODE,
	RE_DATE,
	RE_STATE
	FROM RE WHERE RE_STATE = 'OA'AND RE_SPCODE = #{sp}
    </select>
    
    <select id="getSupplyWaitOrderListD" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.RequestOrderDetailBean">
	SELECT 
	RD_PRSPCODE, 
	RD_RECODE, 
	PR_CODE, 
	RD_QUANTITY, 
	RD_STCODE 
	FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD_RECODE = #{re_code}
    </select>
    
    <select id="getSupplyClearOrderListD" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.RequestOrderDetailBean">
	SELECT 
	RD_PRSPCODE, 
	RD_RECODE, 
	PR_CODE, 
	RD_QUANTITY, 
	RD_STCODE 
	FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD_RECODE = #{re_code}
    </select>
    
    <select id="updateRequestOrderState" parameterType="mrone.teamone.beans.RequestOrderDetailBean" resultType="mrone.teamone.beans.RequestOrderBean">
	UPDATE REQUEST SET RE_STATE = 'OA' WHERE RE_CODE = #{rd_recode}
    </select>
    
    <select id="updateRequestOrderState2" parameterType="mrone.teamone.beans.RequestOrderDetailBean" resultType="mrone.teamone.beans.RequestOrderBean">
	UPDATE REQUESTDETAIL SET RD_STCODE = 'OA' WHERE RD_RECODE = #{rd_recode}
    </select>
    
    <insert id="insertDL" parameterType="mrone.teamone.beans.RequestOrderDetailBean" >
	INSERT INTO DELIVERY VALUES ('222222222', #{rd_recode}, '1', 'ANY000', '000000000')
    </insert>
    
    <select id="getDLlist"  resultType="mrone.teamone.beans.DeliveryBean">
	SELECT 
	DL_CODE, 
	DL_OSCODE, 
	DS_CODE, 
	DS_NAME, 
	DV_CODE, 
	DV_NAME, 
    DL_LCCODE 
	FROM DL INNER JOIN DS ON DL.DL_DSCODE = DS.DS_CODE INNER JOIN "DV" ON DL.DL_DVCODE = DV.DV_CODE
    </select>
    
    <update id="updateDL" parameterType="mrone.teamone.beans.DeliveryBean">
 		UPDATE DL SET DL_DSCODE = '2', DL_DVCODE = #{dl_dvcode} WHERE DL_CODE = #{dl_code}
    </update>
    
    <select id="getTaxCL"  resultType="mrone.teamone.beans.ClientInfoBean">
	SELECT 
	CL_CODE, 
	CL_NAME, 
	CL_ADDRESS, 
	CL_CORPNUM   
	FROM CL
    </select>
    
    <select id="choiceSPInfo"  resultType="mrone.teamone.beans.SupplyInfoBean">
	SELECT 
	SP_CODE, 
	SP_NAME, 
	SP_ADDRESS, 
	SP_CORPNUM,  
	SP_TEL, 
	SP_BTYPE, 
	SP_BKIND  
	FROM SP WHERE SP_CODE = 'KR001D'
    </select>
    
     <select id="choiceCLInfo"  resultType="mrone.teamone.beans.ClientInfoBean">
	SELECT 
	CL_CODE, 
	CL_NAME, 
	CL_ADDRESS, 
	CL_CORPNUM,  
	CL_HP, 
	CL_BTYPE, 
	CL_BKIND  
	FROM CL WHERE CL_CODE = #{cl_code}
    </select>
    
    <select id="getTaxDill"  resultType="mrone.teamone.beans.RequestOrderBean">
	SELECT 
	RE_CODE, 
	RE_CLCODE, 
	CL_NAME   
	FROM RE INNER JOIN CL ON RE.RE_CLCODE = CL.CL_CODE WHERE RE_SPCODE = 'KR001D'
    </select>
    
    <select id="choiceDillInfo"  resultType="mrone.teamone.beans.RequestOrderDetailBean">
	SELECT 
	PR_NAME, 
	RD_QUANTITY, 
	PR_PRICE, 
	PR_TAX 
	FROM RD INNER JOIN PR ON RD.RD_PRCODE = PR.PR_CODE WHERE RD_PRSPCODE = 'KR001D'AND RD_RECODE = #{rd_recode}
    </select>
	
</mapper>