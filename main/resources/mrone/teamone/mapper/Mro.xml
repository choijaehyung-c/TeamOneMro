<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="mrone.teamone.mapper.Mro">

	<insert id="insMroRequestOrder" parameterType="mrone.teamone.beans.RequestOrderBean">
		INSERT INTO RE VALUES(TO_CHAR(SYSDATE,'YYMMDD')||SEQ_MRO_REQUESTNUMBER.NEXTVAL,
		#{re_clcode},#{re_spcode},#{re_oscode},TO_DATE(#{re_date},'YYYYMMDDHH24miss'),#{re_state},#{re_origin})
	</insert>

	<insert id="insMroRequestOrderDetail" parameterType="mrone.teamone.beans.RequestOrderDetailBean">
		INSERT INTO RD VALUES(#{rd_prspcode},#{rd_recode},#{rd_prcode},#{rd_quantity},#{rd_stcode},#{rd_note})
	</insert>

	<select id="getRequestOrderData" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="string">
		SELECT MAX(RE_CODE) FROM RE WHERE RE_CLCODE = #{re_clcode}
	</select>

	<select id="getRequestRegisterNewProductList" resultType="mrone.teamone.beans.ProductBean">
    	 SELECT PR_CODE, PR_NAME, PR_STCODE, SP_NAME, CATE_NAME FROM PR INNER JOIN SP ON PR.PR_SPCODE = SP.SP_CODE WHERE PR_STCODE = 'PR'
    </select>
    
    <select id="mroGetNewProductDetail" resultType="mrone.teamone.beans.ProductBean" parameterType="mrone.teamone.beans.ProductBean">
    	SELECT PR_SPCODE, PR_CODE, PR_STOCK, PR_NAME, PR_IMAGE,
             PR_PRICE, PR_TAX, PR_INFO, PR_ORIGIN,
             CATE_NAME, SP_NAME, SP_TEL, SP_ADDRESS, PR_STCODE 
        FROM PR INNER JOIN SP ON PR.PR_SPCODE = SP.SP_CODE WHERE PR_CODE = #{pr_code}
    </select>
    
    <update id="mroResponseNewProduct" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STCODE = #{pr_stcode} WHERE PR_CODE = #{pr_code}
    </update>
    
     <select id="callModifyRequestList" resultType="mrone.teamone.beans.ProductBean">
    	SELECT PR_CODE, PR_NAME, PR_STCODE,  SP_NAME, CATE_NAME FROM PR INNER JOIN SP ON PR.PR_SPCODE = SP.SP_CODE WHERE PR_STCODE = 'MR' OR PR_STCODE = 'DR'
    </select>
    
    <select id="mroGetModifyProductDetail" resultType="mrone.teamone.beans.ProductBean" parameterType="mrone.teamone.beans.ProductBean">
    	 SELECT PR_SPCODE, PR_CODE, PR_STOCK, PR_NAME, PR_IMAGE,
             PR_PRICE, PR_TAX, PR_INFO, PR_ORIGIN,
             CATE_NAME, SP_NAME, SP_TEL, SP_ADDRESS, PR_STCODE 
        FROM PR INNER JOIN SP ON PR.PR_SPCODE = SP.SP_CODE WHERE PR_CODE = #{pr_code} AND PR_STCODE= #{pr_stcode}
    </select>
    
    <update id="mroResponseModifyProduct" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STCODE = #{pr_stcode} WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'MR'
    </update>
 
    <update id="mroResponseDeleteProduct" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STCODE = #{pr_stcode} WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'DR'
    </update>
    
    <update id="updatePCToPD" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STCODE = 'PD' WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'PC'
    </update>
    
     <select id="stcodeCheck" parameterType="mrone.teamone.beans.ProductBean" resultType="int">
    	SELECT COUNT(*) FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
    </select>
    
    <delete id ="deleteStcode" parameterType="mrone.teamone.beans.ProductBean">
    	DELETE FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode} 
    </delete>

	<select id="getSupplyList" resultType="mrone.teamone.beans.SupplyInfoBean">
		SELECT SP.SP_CODE ,
       SP.SP_NAME,
       SP.SP_TEL,
       SP.SP_ADDRESS,
       SP.SP_CORPNUM,
       SP.SP_BKIND,
       BKIND.BK_NAME
		FROM SP INNER JOIN BKIND ON SP.SP_BKIND = BKIND.BK_CODE WHERE "STATE" ='MEMBER'
    </select>
    
    <select id="getClientList" resultType="mrone.teamone.beans.ClientInfoBean">
    	
    	SELECT CL.CL_CODE,
      	 CL.CL_NAME,
      	 CL.CL_ADDRESS,
      	 CL.CL_CORPNUM,
      	 CL.CL_HP,
     	 CL.CL_BTYPE,
      	 CL.CL_BKIND,
     	 BK.BK_NAME
		FROM CL INNER JOIN BK ON CL_BKIND = BK.BK_CODE WHERE "STATE" ='MEMBER'
    </select>
    
    <select id = "getWaitOrderList" resultType="mrone.teamone.beans.MroOrderBean">   
		    SELECT OS.OS_CODE, OS.OS_CLCODE, CL_NAME, OS_DATE, OS_STATE, OD.OD_PRSPCODE, SP.SP_NAME
            FROM ORDERSVIEW OS INNER JOIN OD ON OS.OS_CODE= OD.OD_OSCODE
                               INNER JOIN SP ON OD.OD_PRSPCODE = SP.SP_CODE
            WHERE OS_STATE='OR' OR OS_STATE='OA'
            GROUP BY OS_CODE, OS_CLCODE, CL_NAME, OS_DATE, OS_STATE, OD_PRSPCODE,SP_NAME    
    </select>
    
    <select id="getCompleteOrderList" resultType="mrone.teamone.beans.MroOrderBean">
    		SELECT OS.OS_CODE, OS.OS_CLCODE, CL_NAME, OS_DATE, OS_STATE, OD.OD_PRSPCODE, SP.SP_NAME
            FROM ORDERSVIEW OS INNER JOIN OD ON OS.OS_CODE= OD.OD_OSCODE
                               INNER JOIN SP ON OD.OD_PRSPCODE = SP.SP_CODE
            WHERE OS_STATE='OC' OR OS_STATE='OF'
            GROUP BY OS_CODE, OS_CLCODE, CL_NAME, OS_DATE, OS_STATE, OD_PRSPCODE,SP_NAME
    </select>
    
    <select id="getOrderDetail" parameterType="string" resultType="mrone.teamone.beans.MroOrderDetailBean" >
    	SELECT * FROM ORDERDETAILVIEW WHERE OD_OSCODE= #{osCode}
    </select>
    <!-- Mro 반품리스트 받아오는 쿼리 -->
    <select id="getRefundList" resultType="mrone.teamone.beans.MroOrderBean" >
    	SELECT * FROM ORDERSVIEW WHERE OS_STATE='RR'
    </select>
    
    <!-- Mro 교환리스트 받아오는 쿼리 -->
    <select id="getExchangeList" resultType="mrone.teamone.beans.MroOrderBean" >
    	SELECT * FROM ORDERSVIEW WHERE OS_STATE='ER'
    </select>
    
    <select id="getRefundDetail" parameterType="string" resultType="mrone.teamone.beans.MroOrderDetailBean" >
    	SELECT * FROM ORDERDETAILVIEW WHERE OD_OSCODE= #{osCode}
    </select>
 
 	<!-- new -->
 	<select id="getSearchSupplyList" parameterType="string" resultType="mrone.teamone.beans.SupplyInfoBean">
 	   SELECT SP.SP_CODE ,
       SP.SP_NAME,
       SP.SP_TEL,
       SP.SP_ADDRESS,
       SP.SP_CORPNUM,
       SP.SP_BKIND,
       BKIND.BK_NAME
		FROM SP INNER JOIN BKIND ON SP.SP_BKIND = BKIND.BK_CODE
        WHERE SP_NAME LIKE '%' || #{word} || '%' AND "STATE"='MEMBER'	
 	</select>
 
 	<!-- new -->
 	<select id="getSearchClientList" parameterType="string" resultType="mrone.teamone.beans.ClientInfoBean">
 		SELECT CL.CL_CODE ,
        CL.CL_NAME,
       CL.CL_HP,
       CL.CL_ADDRESS,
       CL.CL_CORPNUM,
       CL.CL_BKIND,
       BKIND.BK_NAME
		FROM CL INNER JOIN BKIND ON CL.CL_BKIND = BKIND.BK_CODE
        WHERE CL_NAME LIKE '%' || #{word} || '%' AND "STATE"='MEMBER'	
 	</select>
	
	<!-- new -->
	<update id="mroDelClient" parameterType="string" >
		UPDATE CL SET "STATE"='NONMEMBER' WHERE CL_CODE=#{code}
	</update>
	
	<!-- new -->
	<update id="mroDelSupply" parameterType="string" >
		UPDATE SP SET "STATE"='NONMEMBER' WHERE SP_CODE=#{code}
	</update>
	
		<select id="getRanking" resultType="mrone.teamone.beans.OrderDetailBean">			
		SELECT SUM(OD_QUANTITY) AS OD_QUANTITY, OD.OD_PRCODE,PR_NAME
		FROM OS INNER JOIN OD ON OS.OS_CODE = OD.OD_OSCODE
                INNER JOIN PR ON OD.OD_PRCODE = PR.PR_CODE
			WHERE OS_DATE >TRUNC(SYSDATE,'MM') AND OS_DATE <![CDATA[<]]> LAST_DAY(SYSDATE) 
			GROUP BY OD.OD_PRCODE, OD_QUANTITY,PR_NAME
			ORDER BY OD_QUANTITY DESC
	</select>
	
	

</mapper>