<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="mrone.teamone.mapper.Mro">
	<insert id="insMroRequestOrder">
		INSERT INTO RE VALUES(TO_CHAR(SYSDATE,'YYMMDD')||SEQ_MRO_REQUESTNUMBER.NEXTVAL,
		#{re_clcode},#{re_spcode},#{re_oscode},TO_DATE(#{re_date},'YYYYMMDDHH24miss'),#{re_state})
	</insert>

	<insert id="insMroRequestOrderDetail">
		INSERT INTO RD VALUES(#{rd_prspcode},#{rd_recode},#{pr_code},#{rd_quantity},#{rd_stcode},#{rd_note})
	</insert>

	<select id="getRequestOrderData">
		SELECT RE_CODE FROM RE WHERE RE_CLCODE = #{re_clcode} and RE_DATE = TO_DATE(#{re_date},'YYYYMMDDHH24miss')
	</select>

	<select id="getRequestRegisterNewProductList" resultType="mrone.teamone.beans.ProductBean">
    	SELECT PR_CODE, PR_NAME, PR_STCODE FROM PR WHERE PR_STCODE = 'PR'
    </select>
    
    <select id="mroGetNewProductDetail" resultType="mrone.teamone.beans.ProductBean" parameterType="mrone.teamone.beans.ProductBean">
    	SELECT * FROM PR WHERE PR_CODE = #{pr_code}
    </select>
    
    <update id="mroResponseNewProduct" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STCODE = #{pr_stcode} WHERE PR_CODE = #{pr_code}
    </update>
    
     <select id="callModifyRequestList" resultType="mrone.teamone.beans.ProductBean">
    	SELECT PR_CODE, PR_NAME, PR_STCODE FROM PR WHERE PR_STCODE = 'MR' OR PR_STCODE = 'DR'
    </select>
    
    <select id="mroGetModifyProductDetail" resultType="mrone.teamone.beans.ProductBean" parameterType="mrone.teamone.beans.ProductBean">
    	SELECT * FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
    </select>
    
    <update id="mroResponseModifyProduct" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STCODE = #{pr_stcode} WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'MR'
    </update>
 
    <update id="mroResponseDeleteProduct" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STCODE = #{pr_stcode} WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'DR'
    </update>
    
    <update id="updatePCToPD" parameterType="mrone.teamone.beans.ProductBean">
    	UPDATE PR SET PR_STCODE = 'PD' WHERE PR_CODE = #{pr_code} AND PR_STCODE = 'PC'
    </update>
    
     <select id="stcodeCheck" parameterType="mrone.teamone.beans.ProductBean" resultType="int">
    	SELECT COUNT(*) FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode}
    </select>
    
    <delete id ="deleteStcode" parameterType="mrone.teamone.beans.ProductBean">
    	DELETE FROM PR WHERE PR_CODE = #{pr_code} AND PR_STCODE = #{pr_stcode} 
    </delete>

	<select id="getSupplyList" resultType="mrone.teamone.beans.SupplyInfoBean">
		SELECT SP.SP_CODE ,
       SP.SP_NAME,
       SP.SP_TEL,
       SP.SP_ADDRESS,
       SP.SP_CORPNUM,
       SP.SP_BKIND,
       BKIND.BK_NAME
		FROM SP INNER JOIN BKIND ON SP.SP_BKIND = BKIND.BK_CODE
    </select>
    
    <select id="getClientList" resultType="mrone.teamone.beans.ClientInfoBean">
    	
    	SELECT CL.CL_CODE,
      	 CL.CL_NAME,
      	 CL.CL_ADDRESS,
      	 CL.CL_CORPNUM,
      	 CL.CL_HP,
     	 CL.CL_BTYPE,
      	 CL.CL_BKIND,
     	 BK.BK_NAME
		FROM CL INNER JOIN BK ON CL_BKIND = BK.BK_CODE
    </select>
    
    <select id = "getWaitOrderList" resultType="mrone.teamone.beans.MroOrderBean">   
		SELECT * FROM ORDERSVIEW WHERE OS_STATE='OR'	    
    </select>
    
    <select id="getOrderDetail" parameterType="string" resultType="mrone.teamone.beans.MroOrderDetailBean" >
    	SELECT * FROM ORDERDETAILVIEW WHERE OD_OSCODE= #{osCode}
    </select>
    <!-- Mro 반품리스트 받아오는 쿼리 -->
    <select id="getRefundList" resultType="mrone.teamone.beans.MroOrderBean" >
    	SELECT * FROM ORDERSVIEW WHERE OS_STATE='RR'
    </select>
    
    <!-- Mro 교환리스트 받아오는 쿼리 -->
    <select id="getExchangeList" resultType="mrone.teamone.beans.MroOrderBean" >
    	SELECT * FROM ORDERSVIEW WHERE OS_STATE='ER'
    </select>
    
    <select id="getRefundDetail" parameterType="string" resultType="mrone.teamone.beans.MroOrderDetailBean" >
    	SELECT * FROM ORDERDETAILVIEW WHERE OD_OSCODE= #{osCode}
    </select>
    
    <!-- 공급사가 본인의 회사에 들어온 반품,교환리스트를 받는 쿼리 -->
     <select id="getRefundListSp" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.RequestOrderBean" >		
		    SELECT REV.RE_CODE,
       		REV.RE_CLCODE,
      	 	REV.CL_NAME,
       		REV.RE_DATE,
            REV.CL_HP,
       		RDV.RD_STCODE AS RE_STATE
		FROM REQUESTVIEW REV INNER JOIN REQUESTDETAILVIEW RDV ON rev.re_code = rdv.rd_recode 
		WHERE RD_STCODE=#{re_state} AND RD_PRSPCODE=#{re_spcode}
        GROUP BY REV.RE_CODE ,REV.RE_CLCODE, REV.CL_NAME,REV.RE_DATE, RDV.RD_STCODE, REV.CL_HP
    </select>
    
    <!-- 상세리스트 -->
    <select id="supplyReceiveAsDetail" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.RequestOrderDetailBean">
    		SELECT * FROM REQUESTDETAILVIEW WHERE RD_RECODE=#{re_code}
    </select>
    
    <!-- 반품요청->반품처리로 (수락) 업데이트 -->
    <update id="supplyResponseRefund" parameterType="mrone.teamone.beans.RequestOrderBean">
    	UPDATE OD SET OD_STCODE=#{re_state} WHERE OD_OSCODE=#{re_code} AND OD_STCODE='RR'
    </update>
    
    <!-- 반품 OS테이블 RR인거 업데이트ㅡ -->
    <update id="supplyResponseRefundOS" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE OS SET OS_STATE = #{re_state} WHERE OS_CODE=#{re_code} AND OS_STATE='RR'
    </update>
    
    <!-- 반품 RD테이블 RR인거 업데이트ㅡ -->
    <update id="supplyResponseRefundRD" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE RD SET RD_STCODE = #{re_state} WHERE RD_RECODE=#{re_code} AND RD_STCODE='RR'
    </update>
    
    <!-- 반품 RE테이블 RR인거 업데이트ㅡ -->
    <update id="supplyResponseRefundRE" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE RE SET RE_STATE = #{re_state} WHERE RE_CODE=#{re_code} AND RE_STATE='RR'
    </update>
    
    <!-- 쓰는거 -->
    <select id="selRequest" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.MroOrderDetailBean">
    	select od.od_prspcode,
       od.od_oscode,
       od.od_stcode,
       od.od_prcode,
       od.od_quantity,
       od.od_note,
       os.os_clcode
	from od inner join os on od.od_oscode = os.os_code 
	where OD_OSCODE= #{re_code} AND OD_STCODE=#{re_state}
    </select>
    
    <!-- 쓰는거 -->
    <insert id="insNewOrders" parameterType="mrone.teamone.beans.RequestOrderBean">
    	INSERT INTO OS VALUES(TO_CHAR(SYSDATE,'YYMMDD')||SEQ_CLIENT_ORDERNUMBER.NEXTVAL,#{re_clcode},SYSDATE,#{re_state})
    </insert>
    
    <!--  쓰는거-->
    <insert id="insNewOd" parameterType="mrone.teamone.beans.MroOrderDetailBean">
    	INSERT INTO OD VALUES (#{od_prspcode},TO_CHAR(SYSDATE,'YYMMDD')||#{od_oscode},#{od_stcode},#{od_prcode},#{od_quantity},'')
    </insert>
    
    <!-- 쓰는거 -->
    <insert id= "insNewRequest" parameterType="mrone.teamone.beans.RequestOrderBean">
    	INSERT INTO RE VALUES (TO_CHAR(SYSDATE,'YYMMDD')||#{re_oscode},#{re_clcode},#{re_spcode},TO_CHAR(SYSDATE,'YYMMDD')||#{re_oscode},SYSDATE,#{re_state})
    </insert>
    
    <!-- 쓰는거 -->
    <insert id= "insNewRd" parameterType="mrone.teamone.beans.MroOrderDetailBean">
    	INSERT INTO RD VALUES (#{od_prspcode}, TO_CHAR(SYSDATE,'YYMMDD')||#{od_oscode},#{od_prcode},#{od_quantity},#{od_stcode},'')
    </insert>
    
    <!-- 교환 OD 테이블 요청 -> 수락 또는 거절 -->
      <update id="supplyResponseExchangeOD" parameterType="mrone.teamone.beans.RequestOrderBean">
    	UPDATE OD SET OD_STCODE=#{re_state} WHERE OD_OSCODE=#{re_code} AND OD_STCODE='ER'
    </update>
    
    <!-- 교환 OS 테이블 요청 -> ER인거 업데이트 -->
      <update id="supplyResponseExchangeOS" parameterType="mrone.teamone.beans.RequestOrderBean">
   		 UPDATE OS SET OS_STATE = #{re_state} WHERE OS_CODE=#{re_code} AND OS_STATE='ER'
    </update>
    
     <update id="supplyResponseExchageRD" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE RD SET RD_STCODE = #{re_state} WHERE RD_RECODE=#{re_code} AND RD_STCODE='ER'
    </update>
    
    
    <update id="supplyResponseExchageRE" parameterType="mrone.teamone.beans.RequestOrderBean">
 		UPDATE RE SET RE_STATE = #{re_state} WHERE RE_CODE=#{re_code} AND RE_STATE='ER'
    </update>
 	
	<select id="supplySearchAs" parameterType="mrone.teamone.beans.RequestOrderBean" resultType="mrone.teamone.beans.RequestOrderBean">
		   SELECT * FROM REQUESTVIEW WHERE "WORD" LIKE '%'|| #{word} ||'%' 
	</select>
	
	<select id="getCount" resultType="int">
		SELECT
		MAX(TO_NUMBER(SUBSTR(OS_CODE,7,5))) FROM OS WHERE SUBSTR(OS_CODE,1,6) =
		TO_CHAR(SYSDATE,'YYMMDD')
	</select>
	
	<insert id="makeDeliveryLocate">
		INSERT INTO LC VALUES (TO_CHAR(SYSDATE,'YYMMDD')||SEQ_LOCATION_NUM.NEXTVAL,'00.000000','000.000000',TO_CHAR(SYSDATE,'YYMMDD'))
	</insert>
	
	<select id="maxLCcode" resultType="string">
		SELECT 
		MAX(TO_NUMBER(SUBSTR(LC_CODE,1,9))) AS lccode FROM LC WHERE SUBSTR(LC_CODE,1,6) =
		TO_CHAR(SYSDATE,'YYMMDD')
	</select>
	
	<insert id="supplyAskDelivery" parameterType="mrone.teamone.beans.DeliveryBean">
		INSERT INTO DL VALUES (TO_CHAR(SYSDATE,'YYMMDD')||SEQ_DELIVERY_NUM.NEXTVAL, #{dl_oscode},#{dl_dscode},#{dl_dvcode},#{dl_lccode})
	</insert>
	
	
	<select id="supplyGetCategory" resultType="mrone.teamone.beans.ProductBean">
		SELECT * FROM CG
	</select>
	
	<select id="supplyProductList" parameterType="mrone.teamone.beans.ProductBean" resultType="mrone.teamone.beans.ProductBean">
		SELECT * FROM PR WHERE PR_SPCODE=#{pr_spcode} AND CATE=#{cate}
	</select>
	
	<select id="supplySearchProduct" parameterType="mrone.teamone.beans.ProductBean" resultType="mrone.teamone.beans.ProductBean">
		SELECT * FROM PRODUCTVIEW WHERE PR_SPCODE=#{pr_spcode} AND "WORD" LIKE '%'|| #{word}||'%'
	</select>

</mapper>